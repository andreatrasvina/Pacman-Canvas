<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PACMAN</title>
    <style>
        canvas {
            background-color: gray;
        }
    </style>
</head>
<body>
    <canvas id="my_canvas" width="500" height="500"></canvas>
    <script type="text/javascript">
        const canvas = document.getElementById("my_canvas");
        const ctx = canvas.getContext('2d');
        
        let direction = "";
        let score = 0;
        let walls = [];
        let pause = false;
        
        const playerImage = new Image();
        playerImage.src = 'assets/images/esponga.png'; 
        
        const scoreImage = new Image();
        scoreImage.src = 'assets/images/plato.png'; 
        
        const collisionSound = new Audio('limpio.mp3');
        
        class Rectangle {
            constructor(x, y, w, h, color) {
                this.x = x;
                this.y = y;
                this.w = w;
                this.h = h;
                this.color = color;
            }

            isCollidingWith(other) {
                return this.x < other.x + other.w &&
                       this.x + this.w > other.x &&
                       this.y < other.y + other.h &&
                       this.y + this.h > other.y;
            }
        }
        
        let player = new Rectangle(250, 250, 40, 40, getRandomColor());
        let food = new Rectangle(Math.floor(Math.random() * (canvas.width - 40)), 
                                 Math.floor(Math.random() * (canvas.height - 40)), 
                                 40, 40, getRandomColor());
        
        walls.push(new Rectangle(80, 350, 320, 40, getRandomColor()));
        walls.push(new Rectangle(80, 100, 320, 40, getRandomColor()));
        
        document.addEventListener('keydown', function(e) {
            switch(e.keyCode) {
                case 37: // LEFT
                    direction = "left";
                    break;
                case 38: // UP
                    direction = "up";
                    break;
                case 39: // RIGHT
                    direction = "right";
                    break;
                case 40: // DOWN
                    direction = "down";
                    break;
                case 32: // SPACE
                    pause = !pause;
                    break;
            }
        });

        function update() {
            if (!pause) {
                const speed = 5;
                switch(direction) {
                    case "left":
                        player.x -= speed;
                        if (player.x < 0) player.x = canvas.width;
                        break;
                    case "up":
                        player.y -= speed;
                        if (player.y < 0) player.y = canvas.height;
                        break;
                    case "right":
                        player.x += speed;
                        if (player.x > canvas.width) player.x = -player.w;
                        break;
                    case "down":
                        player.y += speed;
                        if (player.y > canvas.height) player.y = -player.h;
                        break;
                }
                
                walls.forEach(wall => {
                    if (player.isCollidingWith(wall)) {
                        switch(direction) {
                            case "left":
                                player.x += speed;
                                break;
                            case "up":
                                player.y += speed;
                                break;
                            case "right":
                                player.x -= speed;
                                break;
                            case "down":
                                player.y -= speed;
                                break;
                        }
                    }
                });

                if (player.isCollidingWith(food)) {
                    score++;
                    player.s = player.s+1;
                    collisionSound.play();
                    food.x = Math.floor(Math.random() * (canvas.width - 40));
                    food.y = Math.floor(Math.random() * (canvas.height - 40));
                }
            }
        }

        function draw() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            ctx.drawImage(playerImage, player.x, player.y, player.w, player.h);
        
            ctx.drawImage(scoreImage, food.x, food.y, food.w, food.h);
            
            walls.forEach(wall => {
                ctx.fillStyle = wall.color;
                ctx.fillRect(wall.x, wall.y, wall.w, wall.h);
            });
            
            ctx.fillStyle = "white";
            ctx.font = "20px Arial";
            ctx.fillText("Score: " + score, 20, 20);
            
            if (pause) {
                ctx.fillStyle = "white";
                ctx.font = "40px Arial";
                ctx.fillText("PAUSE", canvas.width / 2 - 60, canvas.height / 2);
            }
        }

        function gameLoop() {
            update();
            draw();
            requestAnimationFrame(gameLoop);
        }
        
        gameLoop();

        function getRandomColor() {
            const letters = '0123456789ABCDEF';
            let color = '#';
            for (let i = 0; i < 6; i++) {
                color += letters[Math.floor(Math.random() * 16)];
            }
            return color;
        }
    </script>
</body>
</html>
